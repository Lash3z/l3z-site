<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Predictions — L3Z</title>
<link rel="icon" type="image/png" href="/assets/L3Z_logoMain.png">
<style>
  :root{--bg:#0b0f14;--panel:#11161d;--ink:#e9f1ff;--line:rgba(0,255,255,.18);--gold:#ffcc66;--ok:#12d48a;--bad:#ff8fa0;--chip:#0c141a}
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Arial,sans-serif}
  a{color:#9bd3ff;text-decoration:none}.wrap{max-width:1100px;margin:0 auto;padding:16px}
  .top{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
  .pill{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#0a1016;color:#cfe;font-weight:800}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px} @media (max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg,#0f131a,#0a0f15);border:1px solid var(--line);border-radius:14px;overflow:hidden}
  .head{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line)}
  .head h2{margin:0;font-size:14px;letter-spacing:.3px;color:#ffd78a}
  .body{padding:12px 14px;display:grid;gap:10px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}.row>label{min-width:140px;color:#cbd5e1}
  input,select,button,textarea{background:#0f141b;border:1px solid var(--line);color:#e9f1ff;border-radius:10px;padding:10px 12px;font-size:14px}
  textarea{min-height:80px;width:100%} button{cursor:pointer;font-weight:800}
  button.primary{background:linear-gradient(180deg,#f5c462,#d49a2e);color:#1a1204;border:none} button.ghost{background:#111a22}
  .ok{color:#12d48a} .err{color:#ff8fa0} .muted{color:#9fb3c5} .badge{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid rgba(255,255,255,.08);border-radius:999px;padding:6px 10px}
  .small{font-size:12px;color:#9fb3c5} .list{display:grid;gap:8px;max-height:260px;overflow:auto} .item{display:flex;justify-content:space-between;gap:8px;padding:8px 10px;background:#0d141b;border:1px solid var(--line);border-radius:10px}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div style="display:flex;align-items:center;gap:10px"><img src="/assets/l3z_logo.png" alt="" style="width:36px;height:36px;border-radius:10px;border:1px solid var(--line)"><div class="pill">Predictions</div></div>
    <div style="display:flex;gap:8px;align-items:center">
      <div class="pill" id="whoami">—</div><div class="pill"><span id="walletBalance">0 LBX</span></div>
      <a class="pill" href="/pages/dashboard/home/profile.html" style="border-color:#3a5166">Profile</a>
      <a class="pill" href="/pages/dashboard/home/leaderboard.html" style="border-color:#3a5166">Leaderboard</a>
    </div>
  </div>

  <div class="grid">
    <section class="card">
      <div class="head"><h2>Submit Prediction</h2><div class="badge">server-backed</div></div>
      <div class="body">
        <div class="row"><label>Hunt Type</label><select id="huntType"><option value="Mega">Mega Hunt</option><option value="Super">Super Hunt</option><option value="Player">Player Hunt</option></select></div>
        <div class="row"><label>Top Game</label><select id="topGame"><option>Gates of Olympus</option><option>Sweet Bonanza</option><option>Wanted Dead or a Wild</option><option>Sugar Rush</option><option>Dog House Megaways</option></select></div>
        <div class="row"><label>Hit 100x?</label><input id="hundredX" type="number" step="1" min="0" placeholder="0 = no, 1+ = yes (closest guess)"/></div>
        <div class="row"><label>Profit Overall?</label><select id="profitYesNo"><option value="true">Yes — profit</option><option value="false">No — loss</option><option value="">(skip)</option></select></div>
        <div class="row" style="gap:10px"><button id="btnSubmit" class="primary">Submit</button><span id="predStatus" class="muted"></span></div>
        <div class="small">Submits to <code>/api/predictions/submit</code>. Points are awarded by mods later.</div>
      </div>
    </section>

    <section class="card">
      <div class="head"><h2>Your Recent Activity</h2><div class="badge">latest</div></div>
      <div class="body">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
          <div><div class="row" style="justify-content:space-between"><div class="small">Transactions</div><button id="btnTx" class="ghost">Refresh</button></div><div id="txList" class="list"></div></div>
          <div><div class="row" style="justify-content:space-between"><div class="small">Bets</div><button id="btnBets" class="ghost">Refresh</button></div><div id="betsList" class="list"></div></div>
        </div>
      </div>
    </section>
  </div>
</div>

<script src="/assets/api-base.js"></script>
<script src="/assets/js/bootstrap-auth.js"></script>
<script>
(function(){
  const $=(s,r=document)=>r.querySelector(s);
  const hundredX=$("#hundredX"), profitYesNo=$("#profitYesNo"), predStatus=$("#predStatus");
  const txList=$("#txList"), betsList=$("#betsList");
  const huntType=$("#huntType"), topGame=$("#topGame");

  function fmtLBX(n){ return `${Number(n||0).toLocaleString()} LBX`; }
  function item(label, value, extra=""){ const div=document.createElement("div"); div.className="item"; div.innerHTML=`<div>${label}</div><div class="small">${value}${extra?` — ${extra}`:""}</div>`; return div; }

  async function refreshTx(){ txList.innerHTML=""; try{ const j=await api.get("/api/tx/history"); (j.tx||[]).slice(0,30).forEach(t=>{ txList.appendChild(item(t.type.replace(/_/g," "),(t.amount>0?"+":"")+t.amount,new Date(t.createdAt).toLocaleString())); }); }catch(e){ txList.appendChild(item("Error", e.message||"failed")); } }
  async function refreshBets(){ betsList.innerHTML=""; try{ const j=await api.get("/api/bets/history"); (j.bets||[]).slice(0,30).forEach(b=>{ const st=b.status+(b.payout!=null?` (${b.payout>0?"+":""}${b.payout})`:""); betsList.appendChild(item(b.game||"—", b.amount, st)); }); }catch(e){ betsList.appendChild(item("Error", e.message||"failed")); } }

  $("#btnSubmit")?.addEventListener("click", async ()=>{
    predStatus.textContent="Submitting…"; predStatus.className="muted";
    try{
      const body={ huntType:huntType.value, hundredX:Number(hundredX.value||0), topGame:topGame.value, profitYesNo: profitYesNo.value===""? null : (profitYesNo.value==="true") };
      if(!body.huntType || !body.topGame) throw new Error("Missing hunt type or top game.");
      await api.post("/api/predictions/submit", body);
      predStatus.textContent="Prediction submitted."; predStatus.className="ok";
      hundredX.value="0"; profitYesNo.value="";
    }catch(e){ predStatus.textContent=(e.message||"failed").replace(/_/g," "); predStatus.className="err"; }
  });

  $("#btnTx")?.addEventListener("click", refreshTx); $("#btnBets")?.addEventListener("click", refreshBets);
  (async function(){ await Promise.all([refreshTx(), refreshBets()]); })();
})();
</script>
</body>
</html>

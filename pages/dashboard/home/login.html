<!DOCTYPE html>
<html lang="en" data-admin="checking">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<meta http-equiv="Cache-Control" content="no-store"/>
<title>L3Z — Admin Hub</title>
<style>
  :root{ --bg:#060b0d; --panel:#0b1417; --ink:#eaf7ff; --muted:#9fd0d6;
         --line:rgba(0,255,255,.18); --teal:#00ffff; --gold:#ffb42d;
         --ok:#12d48a; --bad:#e25a6f; --ink2:#cfffff; }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Segoe UI,system-ui,Arial,sans-serif}
  html[data-admin="checking"] body{opacity:0;transition:opacity .12s ease}
  h1{margin:16px 0 8px;color:var(--teal);text-shadow:0 0 14px #00ffff55}
  h2{margin:0 0 10px;font-size:16px;color:var(--ink)}
  .wrap{max-width:1300px;margin:0 auto;padding:0 16px 48px}
  .toprow{display:flex;gap:10px;align-items:center;justify-content:space-between}
  .toprow .right{display:flex;gap:10px;align-items:center}
  .gate{background:linear-gradient(180deg,#0a1418,#0a1216);border:1px solid var(--line);border-radius:14px;padding:14px;margin-top:12px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px}
  .panel{background:linear-gradient(180deg,#0a1418,#0a1216);border:1px solid var(--line);border-radius:14px;padding:12px;min-height:220px}
  .full{grid-column:1 / -1}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .pill{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#081318;color:var(--ink2)}
  input,select,textarea{border-radius:10px;border:1px solid var(--line);background:#0c1519;color:var(--ink);padding:8px}
  textarea{width:100%;min-height:80px}
  button{border:1px solid var(--line);border-radius:10px;padding:8px 12px;background:#0f1720;color:var(--ink);font-weight:800;cursor:pointer}
  button.ok{background:#103d30;border-color:#1fa37b}
  button.danger{background:#2b1116;border-color:#7e2a3c}
  button.warn{background:#231b0f;border-color:#8c6926}
  button[disabled]{opacity:.5;cursor:not-allowed}
  .hr{height:1px;background:var(--line);margin:10px 0}
  .tbl{width:100%;border-collapse:separate;border-spacing:0;overflow:auto}
  .tbl th,.tbl td{border-bottom:1px solid rgba(255,255,255,.06);padding:8px;text-align:left;font-size:13px}
  .tbl th{color:var(--muted)}
  .right{margin-left:auto}
  .hint{color:var(--muted);font-size:12px}
  .mini{font-size:12px;color:var(--muted)}
  .badge{padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:#081318;color:#bfe}
  .toast{position:fixed;right:16px;bottom:16px;background:#0b1f21;border:1px solid var(--line);border-radius:10px;padding:10px 12px;opacity:0;transform:translateY(8px);transition:.2s all;pointer-events:none}
  .toast.on{opacity:1;transform:translateY(0)}
  a.linkbtn{border:1px solid var(--line);border-radius:10px;padding:8px 12px;background:#0f1720;color:#9fd0d6;text-decoration:none;font-weight:800}
  a.linkbtn:hover{filter:brightness(1.1)}
  @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>

<!-- Admin cookie check -->
<script>
(function(){
  const ADMIN_CHECK="/api/admin/gate/check";
  const ADMIN_LOGIN="/pages/dashboard/home/admin_login.html";
  const DASHBOARD="/index.html";
  const H=document.documentElement;
  H.setAttribute("data-admin","checking");
  function lock(){
    H.removeAttribute("data-admin");
    document.body.innerHTML='<div class="lockwrap"><div class="lockcard"><h1>Administration Locked</h1><div>You must unlock admin on the <a href="'+ADMIN_LOGIN+'?redirect=%2Fpages%2Fdashboard%2Fadmin%2Fadmin_hub.html">Admin Login</a> first.</div><div style="margin-top:8px;font-size:12px;opacity:.85">If you already logged in, your session may have expired.</div><div style="margin-top:14px"><a href="'+DASHBOARD+'">Back to Dashboard</a></div></div></div>';
  }
  fetch(ADMIN_CHECK,{credentials:"include",cache:"no-store"})
    .then(r=>r.ok?r.json():null)
    .then(j=>{ if(j&&j.admin){ try{localStorage.setItem("l3z:admin:unlocked","1");}catch{} H.removeAttribute("data-admin"); } else lock(); })
    .catch(lock);
})();
</script>

<div class="wrap">

  <div class="toprow">
    <h1>Admin Hub</h1>
    <div class="right">
      <a class="linkbtn" href="/index.html">← Back</a>
      <a id="adminLogout" class="linkbtn" href="#">Log out</a>
    </div>
  </div>

  <!-- Local unlock -->
  <div id="gate" class="gate">
    <div class="row">
      <span class="pill">Unlock Panels</span>
      <input id="gate-u" placeholder="Username" style="width:160px">
      <input id="gate-p" placeholder="Password" type="password" style="width:160px">
      <button id="gate-unlock" class="ok">Unlock</button>
      <button id="gate-lock" class="danger">Lock</button>
      <span id="gate-status" class="pill">Locked</span>
    </div>
  </div>

  <div id="grid" class="grid" style="display:none">

    <!-- CODE GENERATOR -->
    <div class="panel">
      <h2>Promo Code</h2>
      <div class="row">
        <button id="btnGetCode" class="ok">Get Code</button>
        <span id="codeOut" class="pill">—</span>
      </div>
      <div class="hint">Code only created once you press the button. Re-pressing will just return your existing one.</div>
    </div>

    <!-- … existing panels below unchanged … -->
    <!-- Raffles, Prize Claims, Wallet Adjust, etc. -->
  </div>
</div>

<div id="toast" class="toast">Saved.</div>

<script>
(function(){
  "use strict";
  const $=(s,r=document)=>r.querySelector(s);
  const toast=t=>{const b=$("#toast");b.textContent=t;b.classList.add("on");setTimeout(()=>b.classList.remove("on"),1400);};

  // logout
  $("#adminLogout").addEventListener("click",async e=>{
    e.preventDefault();
    try{await fetch("/api/admin/gate/logout",{method:"POST",credentials:"include"});}catch{}
    localStorage.removeItem("l3z:admin:unlocked");
    location.href="/index.html";
  });

  // unlock toggle
  const unlocked=()=>localStorage.getItem("l3z:admin:unlocked")==="1";
  function syncGate(){ $("#gate-status").textContent=unlocked()?"Unlocked":"Locked"; $("#grid").style.display=unlocked()?"":"none"; }
  $("#gate-unlock").addEventListener("click",()=>{ if($("#gate-u").value&&$("#gate-p").value){ localStorage.setItem("l3z:admin:unlocked","1"); syncGate(); toast("Unlocked"); } else toast("Enter credentials"); });
  $("#gate-lock").addEventListener("click",()=>{ localStorage.removeItem("l3z:admin:unlocked"); syncGate(); });

  // CODE GENERATOR (manual only)
  $("#btnGetCode").addEventListener("click",async()=>{
    $("#btnGetCode").disabled=true;
    try{
      const res=await fetch("/api/promo/issue",{method:"POST",credentials:"include"});
      const j=await res.json();
      if(j.ok) $("#codeOut").textContent=j.code;
      else $("#codeOut").textContent="Error";
    }catch{ $("#codeOut").textContent="Error"; }
    $("#btnGetCode").disabled=false;
  });

  syncGate();
})();
</script>
</body>
</html>

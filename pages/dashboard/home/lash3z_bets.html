<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Player Betting Slip — Lash3zBux</title>
<link rel="icon" href="/assets/L3Z_logoMain.png">
<style>
  :root{ --bg:#0b0f14; --panel:#0f151c; --ink:#eaf6ff; --muted:#9fb1c7; --line:rgba(0,255,255,.18); --ring:rgba(0,255,255,.28); --cyan:#00ffff; --gold:#ffcc66; }
  *,*:before,*:after{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Segoe UI",system-ui,Arial,sans-serif}
  .wrap{max-width:1200px;margin:22px auto;padding:0 12px}
  .top{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:12px}
  .tabs{display:flex;gap:10px;flex-wrap:wrap}
  .pill{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#0a1016;color:#cfe;font-weight:800}
  .btn-tab{appearance:none;background:none;border:none;padding:0;cursor:pointer}
  .btn-tab.on{background:rgba(0,255,255,.08);border-color:var(--cyan);box-shadow:0 0 0 1px rgba(0,255,255,.1) inset}
  .welcome{margin:0 auto;text-align:center}
  .badge{padding:4px 10px;border-radius:999px;border:1px solid var(--line);background:#091319;color:#cff;font-size:12px}
  .wallet{display:flex;align-items:center;gap:8px}
  .wallet .bal{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#0e151c}

  .grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
  .card{background:linear-gradient(180deg,#10171f,#0b1217);border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 24px rgba(0,0,0,.35);overflow:hidden}
  .card .head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.06)}
  .card .head .title{font-weight:900}
  .card .body{padding:12px}
  .muted{color:var(--muted)}
  .tab-panel{display:none}
  .tab-panel[aria-hidden="false"]{display:block}

  .picks-head{display:flex;align-items:center;gap:10px}
  .count{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;border:1px solid var(--line);background:#0c141a}
  .subtabs{display:flex;gap:14px;margin-top:8px}
  .subtabs .link{font-weight:800;cursor:pointer}
  .subtabs .link.on{color:var(--gold);text-decoration:underline 2px}
  .empty{border:1px dashed var(--line);border-radius:10px;padding:16px;text-align:center;background:#0d151b;color:#cfe}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{padding:8px 12px;border:1px solid var(--line);border-radius:10px;background:#0f1a1f;color:#cfe;font-weight:800;cursor:pointer}
  .btn.ok{border-color:#0ef}
  .field{width:100%;padding:9px 12px;border-radius:10px;border:1px solid var(--line);background:#0e151b;color:var(--ink)}
  .note{font-size:12px;color:#9fc;margin-top:8px}
  @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="tabs" role="tablist" aria-label="Modes">
      <button id="tab-bg"   class="btn-tab pill on" role="tab" aria-selected="true"  aria-controls="panel-bg"   data-tab="bg">Battleground</button>
      <button id="tab-bh"   class="btn-tab pill"     role="tab" aria-selected="false" aria-controls="panel-bh"   data-tab="bh">Bonus Hunt</button>
      <button id="tab-pvp"  class="btn-tab pill"     role="tab" aria-selected="false" aria-controls="panel-pvp"  data-tab="pvp">PVP</button>
    </div>
    <div class="welcome"><span class="badge" id="welcome">Welcome, PLAYER</span></div>
    <div class="wallet"><span class="bal"><b id="balance">0.00</b> LBX</span></div>
  </div>

  <div class="grid">
    <section id="panel-bg"  class="tab-panel card" role="tabpanel" aria-labelledby="tab-bg"  aria-hidden="false">
      <div class="head"><div class="title">Battleground — Custom Markets</div></div>
      <div class="body">
        <div class="row">
          <input id="leftTeam"  class="field" placeholder="Left team / player">
          <input id="rightTeam" class="field" placeholder="Right team / player">
          <input id="pickName"  class="field" placeholder="Your pick (e.g., LEFT, OVER 2.5, etc.)">
        </div>
        <div class="row">
          <input id="eventTitle" class="field" placeholder="Event title (e.g., Friday Fight Night)">
          <input id="eventId"    class="field" placeholder="Event ID (optional)">
        </div>
        <div class="row">
          <button class="btn ok" id="saveSlip">Save Pick</button>
        </div>
        <div class="note" id="status"></div>
      </div>
    </section>

    <section id="panel-bh"  class="tab-panel card" role="tabpanel" aria-labelledby="tab-bh"  aria-hidden="true">
      <div class="head"><div class="title">Bonus Hunt</div></div>
      <div class="body"><div class="empty">Coming soon.</div></div>
    </section>

    <section id="panel-pvp" class="tab-panel card" role="tabpanel" aria-labelledby="tab-pvp" aria-hidden="true">
      <div class="head"><div class="title">PVP</div></div>
      <div class="body"><div class="empty">Coming soon.</div></div>
    </section>
  </div>
</div>

<!-- shared helper -->
<script src="/assets/api-base.js"></script>

<script>
/* guard to prevent double init if included twice */
if (!window.__L3Z_BETS_INIT__) { window.__L3Z_BETS_INIT__ = true;
(function(){
  "use strict";

  const $ = s => document.querySelector(s);
  const up = s => (s||"").toString().trim().toUpperCase();
  const escapeHTML = s => String(s??'').replace(/[&<>"']/g, m => m==="&"?"&amp;":m==="<"?"&lt;":m===">"?"&gt;":"&quot;");
  const statusEl = $("#status");

  // Tabs
  const tabs = Array.from(document.querySelectorAll('[role="tab"]'));
  const panels = { bg:$("#panel-bg"), bh:$("#panel-bh"), pvp:$("#panel-pvp") };
  function setActive(name, user=false){
    tabs.forEach(b=>{ const on=b.dataset.tab===name; b.classList.toggle('on',on); b.setAttribute('aria-selected',String(on)); b.tabIndex=on?0:-1; });
    Object.entries(panels).forEach(([k,el])=> el.setAttribute('aria-hidden', String(k!==name)));
    if(user) history.replaceState(null,"","#"+name);
  }
  document.querySelector('.tabs').addEventListener('keydown', e=>{
    const i = tabs.findIndex(b=>b.classList.contains('on'));
    if(e.key==="ArrowRight"){ e.preventDefault(); setActive(tabs[(i+1)%tabs.length].dataset.tab,true); }
    if(e.key==="ArrowLeft"){  e.preventDefault(); setActive(tabs[(i-1+tabs.length)%tabs.length].dataset.tab,true); }
    if(e.key==="Home"){       e.preventDefault(); setActive(tabs[0].dataset.tab,true); }
    if(e.key==="End"){        e.preventDefault(); setActive(tabs[tabs.length-1].dataset.tab,true); }
  });
  tabs.forEach(b=> b.addEventListener('click', ()=> setActive(b.dataset.tab,true)));
  setActive((location.hash||"").replace(/^#/,"") in panels ? (location.hash||"").slice(1) : "bg", false);

  // Wallet
  async function paintWallet(){
    try{
      const me = await apiFetch("/api/wallet/me");
      $("#welcome").textContent = "Welcome, " + up(me.username || me.user || "PLAYER");
      $("#balance").textContent = Number(me.balance||0).toFixed(2);
    }catch(e){
      $("#welcome").textContent = "Welcome, PLAYER";
      $("#balance").textContent = "0.00";
      console.warn("wallet fetch failed:", e.message);
    }
  }

  // Save bet → POST /api/bets
  window.saveSubmitted = window.saveSubmitted || async function saveSubmitted(entry){
    const body = entry || {
      eventTitle: ($("#eventTitle").value || "Battleground").trim(),
      eventId:    ($("#eventId").value || ("EVT-"+Math.random().toString(36).slice(2,8).toUpperCase())).trim(),
      picks: [{
        left: ($("#leftTeam").value || "").trim(),
        right: ($("#rightTeam").value || "").trim(),
        pickName: ($("#pickName").value || "").trim()
      }]
    };
    if(!body.picks || !body.picks.length || !body.picks[0].left || !body.picks[0].right || !body.picks[0].pickName){
      status("Fill left/right + your pick first.", false); return false;
    }
    try{
      disable(true);
      status("Saving…");
      const res = await apiFetch("/api/bets", { method:"POST", body: JSON.stringify(body) });
      status("Saved ✔", true);
      // clear inputs
      $("#leftTeam").value = $("#rightTeam").value = $("#pickName").value = "";
      $("#eventId").value = "";
      return true;
    }catch(e){
      status("Save failed: " + (e.body?.error || e.message || "Unknown error"), false);
      return false;
    }finally{ disable(false); }
  };

  $("#saveSlip").addEventListener("click", ()=> window.saveSubmitted());

  function disable(on){
    $("#saveSlip").disabled = !!on;
  }
  function status(msg, ok){
    statusEl.textContent = msg || "";
    statusEl.style.color = ok===true ? "#9ff1c7" : ok===false ? "#ff8fa0" : "#9fc";
  }

  // init
  paintWallet();
})();
} /* end guard */
</script>
</body>
</html>

<!-- Filename: public/pages/dashboard/admin/battleground_admin.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Battleground — Admin</title>
<meta http-equiv="Cache-Control" content="no-store"/>
<style>
  :root{
    --bg:#060b0d; --panel:#0b1417; --ink:#eaf7ff; --muted:#9fd0d6; --line:rgba(0,255,255,.18);
    --teal:#00ffff; --ok:#12d48a; --warn:#ffb42d; --danger:#e25a6f; --gold:#ffb42d;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Segoe UI,system-ui,Arial,sans-serif}
  html[data-admin="checking"] body{opacity:0;transition:opacity .12s}
  h1{margin:16px 0 10px;color:var(--teal);text-shadow:0 0 14px #00ffff55}
  .wrap{max-width:1500px;margin:0 auto;padding:0 16px 48px}
  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  input,select,button{border-radius:10px;border:1px solid var(--line);background:#0c1519;color:var(--ink);padding:10px}
  button{cursor:pointer;font-weight:800}
  .btn{padding:10px 12px;border:1px solid var(--line);background:#0f1720;color:var(--ink);border-radius:10px}
  .btn.ok{background:#103d30;border-color:#1fa37b}
  .btn.warn{background:#3a2e10;border-color:#b38328}
  .btn.del{background:#2b1116;border-color:#7e2a3c}
  .card{background:linear-gradient(180deg,#0a1418,#0a1216);border:1px solid var(--line);border-radius:14px;padding:12px;margin-top:12px}
  .pill{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#081318;color:#cfffff}
  .note{font-size:12px;color:#bfe}
  .grid2{display:grid;grid-template-columns:1fr 1.1fr;gap:16px}
  @media (max-width:1200px){.grid2{grid-template-columns:1fr}}
  .frow{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-top:8px}
  .frow .col{display:flex;flex-direction:column;gap:8px}
  .cap{text-transform:uppercase}
  .gamesList{display:flex;flex-direction:column;gap:12px;max-height:calc(100vh - 360px);overflow:auto;padding-right:6px}
  .gameCard{display:grid;grid-template-columns:64px 1fr auto auto;gap:12px;align-items:center;border:1px solid var(--line);border-radius:12px;background:#0b1418;padding:8px 12px}
  .tiny{width:64px;height:86px;border:1px solid var(--line);border-radius:10px;overflow:hidden;background:#000}
  .tiny img{width:100%;height:100%;object-fit:cover;display:block}
  .gtitle{font-weight:900}
  .sub{font-size:12px;color:#9fd0d6}
  .matchesList{display:flex;flex-direction:column;gap:14px;max-height:calc(100vh - 360px);overflow:auto;padding-right:6px}
  .matchCard{display:grid;grid-template-columns:1fr 48px 48px 48px 1fr 160px 80px;grid-template-rows:auto auto;gap:10px;align-items:center;border:1px solid var(--line);border-radius:12px;background:#0b1418;padding:12px}
  .leftName{grid-column:1;grid-row:1;justify-self:end;font-weight:900}
  .leftImg{grid-column:2;grid-row:1}
  .vs{grid-column:3;grid-row:1;display:grid;place-items:center;color:#9fe;font-weight:900}
  .rightImg{grid-column:4;grid-row:1}
  .rightName{grid-column:5;grid-row:1;font-weight:900}
  .thumb{width:48px;height:64px;border:1px solid var(--line);border-radius:8px;overflow:hidden;background:#000}
  .thumb img{width:100%;height:100%;object-fit:cover;display:block}
  .scoreL{grid-column:2;grid-row:2}
  .scoreR{grid-column:4;grid-row:2}
  .controls{grid-column:6 / 8;grid-row:1 / 3;display:flex;gap:8px;justify-content:flex-end;align-items:center}
  .winner{color:var(--gold);filter:drop-shadow(0 0 4px rgba(255,180,45,.4))}
  input[type="number"]{appearance:textfield;width:70px;text-align:center;font-weight:900}
  input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
</style>
</head>
<body>

<!-- AdminGate v2 -->
<script>
(function(){
  "use strict";
  var SESSION_KEY="l3z:session";
  var ADMIN_TOKEN="admin:token";
  var ADMIN_LOGIN="/pages/dashboard/admin/admin_login.html";
  var DASHBOARD="/index.html";
  var MAX_AGE_MS=12*60*60*1000;
  var H=document.documentElement;
  H.setAttribute("data-admin","checking");

  function sget(k){ try{var v=localStorage.getItem(k); return v?JSON.parse(v):null;}catch(e){ return null; } }
  function fresh(x){ return typeof x==="number" && Date.now()<x; }
  function unlock(){ H.removeAttribute("data-admin"); }
  function lock(){
    unlock();
    var s=document.createElement("style");
    s.textContent=".lockwrap{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#0b0f12;color:#eaf7ff;font-family:Segoe UI,system-ui,Arial,sans-serif}.lockcard{max-width:640px;margin:24px;padding:24px;border:1px solid rgba(0,255,255,.2);border-radius:14px;background:rgba(0,0,0,.75);box-shadow:0 0 18px rgba(0,255,255,.15)}.lockcard h1{margin:0 0 10px;color:#cfe}.lockcard a{color:#7ad7ff;text-decoration:underline}";
    document.head.appendChild(s);
    document.body.innerHTML='<div class="lockwrap"><div class="lockcard"><h1>Administration Locked</h1><div>You must unlock admin on the <a href="'+ADMIN_LOGIN+'">Admin Login</a> first.</div><div style="margin-top:8px;font-size:12px;opacity:.85">If you just logged in elsewhere, your unlock may have expired (lasts ~12 hours).</div><div style="margin-top:14px"><a href="'+DASHBOARD+'">Back to Dashboard</a></div></div></div>';
  }

  var sess=sget(SESSION_KEY);
  var tok=sget(ADMIN_TOKEN);
  if(sess && tok && fresh(tok.expiresAt)){ unlock(); return; }

  fetch("/api/auth/session",{credentials:"include",cache:"no-store"})
    .then(function(r){ return r.ok ? r.json() : null; })
    .then(function(j){
      if(j && (j.isAdmin || j.admin===true || j.role==="admin")){
        var u=(j.username||j.user||j.name||"ADMIN").toString().toUpperCase();
        try{
          localStorage.setItem(SESSION_KEY, JSON.stringify({user:u,isAdmin:true,expiresAt:Date.now()+7*24*60*60*1000}));
          localStorage.setItem(ADMIN_TOKEN, JSON.stringify({by:u,ts:Date.now(),expiresAt:Date.now()+MAX_AGE_MS}));
        }catch(e){}
        unlock();
      }else{ lock(); }
    })
    .catch(function(){ lock(); });
})();
</script>
<!-- /AdminGate v2 -->

<div class="wrap">
  <h1>Battleground — Admin</h1>

  <div class="card" style="display:flex;gap:10px;align-items:center">
    <button id="btnSaveDraft" class="btn warn">Save Draft</button>
    <button id="btnPublish" class="btn ok">Push → Prediction + Live + Bets</button>
    <button id="btnDeleteAll" class="btn del" title="Click twice to confirm">Delete All</button>
    <span id="msg" class="pill" style="margin-left:auto">Ready</span>
  </div>

  <!-- … (rest of the page identical to the compat-fixed version I sent; ES5-safe) … -->
</div>

<script>
/* (Full ES5 script here — identical to the compat-fixed version I provided.
   If you want me to paste the entire long script again here, say “paste it all”
   and I’ll drop the whole thing inline.) */
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LASH3Z — Home</title>
  <link rel="icon" type="image/png" href="/assets/L3Z_logoMain.png">

  <!-- Live-friendly security (keeps inline styles/scripts working) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 img-src 'self' data: blob:;
                 style-src 'self' 'unsafe-inline';
                 script-src 'self' 'unsafe-inline';
                 connect-src 'self';
                 frame-ancestors 'none';
                 base-uri 'self'">
  <meta name="color-scheme" content="dark"/>
  <meta name="referrer" content="no-referrer"/>

  <style>
    :root{
      --cyan:#00ffff; --ink:#eaf7ff; --glass:rgba(0,0,0,.85); --panel:#0f1416;
      --line:rgba(0,255,255,.18); --shadow:0 8px 24px rgba(0,0,0,.35);
      --sidew:260px; --toph:72px; --gold:#ffb42d; --dark:#0b1113;
      --icon-size: 54px; --icon-gap: 36px; --icon-radius: 10px; --icon-hover-scale: 1.10;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:'Segoe UI',system-ui,Arial,sans-serif;
      background:url("/assets/BG_page.png") no-repeat center/cover fixed, #0b1113; color:var(--ink);
    }

    /* ===== Topbar ===== */
    .topbar{
      position:fixed; top:0; left:0; right:0; height:var(--toph);
      display:flex; align-items:center; justify-content:center; background:var(--glass);
      box-shadow:0 0 12px var(--cyan); z-index:1000; padding:0 12px;
    }
    .top-inner{position:relative; display:flex; align-items:center; width:100%; max-width:1400px; gap:16px}
    .menu-btn{display:none; border:1px solid var(--line); background:#061214; color:var(--ink); padding:8px 10px; border-radius:10px; cursor:pointer}
    .username-display{color:var(--cyan); font-weight:700; white-space:nowrap}

    .icon-bar{display:flex; align-items:center; gap:var(--icon-gap)}
    .icon-link{width:var(--icon-size); height:var(--icon-size); display:block}
    .icon-img{width:100%; height:100%; display:block; object-fit:contain; border-radius:var(--icon-radius); transition:transform .15s}
    .icon-img:hover{transform:scale(var(--icon-hover-scale))}
    .icon-bar.right{ margin-left:auto; }
    .icon-bar.center{ position:absolute; left:50%; transform:translateX(-50%);}

    .toolbtn{
      border:1px solid var(--line); background:#0f1720; color:var(--ink);
      padding:8px 12px; border-radius:10px; font-weight:800; cursor:pointer; text-decoration:none;
    }
    .toolbtn.ok{background:#103d30;border-color:#1fa37b}
    .toolbtn.bad{background:#2b1116;border-color:#7e2a3c}
    .toolrow{display:flex; gap:10px; margin-left:auto}

    /* ===== Sidebar / Main ===== */
    .sidebar{
      position:fixed; top:var(--toph); left:0; bottom:0; width:var(--sidew);
      background:var(--glass); box-shadow:0 0 16px var(--cyan); overflow:auto; padding:12px; z-index:900;
    }
    .main{ margin-left:var(--sidew); padding:calc(var(--toph) + 16px) 20px 24px; min-height:100vh; }
    .sidebar h3{color:var(--cyan); margin:10px 0 6px; font-size:14px; letter-spacing:.3px}
    .navlink{
      display:flex; align-items:center; gap:10px; width:100%; text-decoration:none; color:#fff;
      background:#111; border:1px solid #1b1b1b; padding:10px 10px; border-radius:8px; margin-bottom:8px;
      transition:background .15s, color .15s, transform .05s;
    }
    .navlink:hover{background:var(--cyan); color:#001113}
    .navlink:active{transform:translateY(1px)}
    .navlink img{width:20px; height:20px; object-fit:contain}

    /* ===== Banner Slider ===== */
    .banner{text-align:center}
    .slider{
      position:relative; max-width:100%; margin:0 auto;
      border-radius:12px; box-shadow:var(--shadow); overflow:hidden; border:1px solid var(--line);
      background:rgba(0,0,0,.5);
    }
    .slider .slide{ display:none; }
    .slider .slide.active{ display:block; }
    .slider img{ width:100%; height:auto; display:block; }
    .slide-nav{
      position:absolute; top:50%; transform:translateY(-50%);
      background:rgba(0,0,0,.45); color:#fff; border:1px solid var(--line);
      width:42px; height:42px; border-radius:50%; cursor:pointer; z-index:2;
      display:grid; place-items:center; font-size:20px;
    }
    .slide-nav:hover{ background:rgba(0,0,0,.65); }
    .slide-nav.prev{ left:10px; } .slide-nav.next{ right:10px; }
    .dots{ position:absolute; left:0; right:0; bottom:10px; display:flex; gap:8px; justify-content:center; z-index:2; }
    .dot{ width:28px; height:6px; border-radius:999px; background:rgba(255,255,255,.35); border:1px solid rgba(255,255,255,.15); cursor:pointer; }
    .dot.active{ background:#bfff00; }

    /* ===== Tiles ===== */
    .tiles{ display:flex; flex-wrap:wrap; justify-content:center; gap:16px; margin-top:24px; }
    .tile{
      width:170px; height:170px; display:flex; flex-direction:column; align-items:center; justify-content:center;
      text-decoration:none; color:#fff; background:rgba(0,0,0,.80);
      border-radius:18px; box-shadow:0 0 16px var(--cyan); transition:transform .2s;
    }
    .tile:hover{transform:scale(1.04)}
    .tile img{width:64px; height:64px; margin-bottom:8px; object-fit:contain}
    .tile span{font-size:15px; text-align:center}

    /* ===== Jackpot ===== */
    .jackpot-wrap{ max-width:1000px; margin:22px auto 8px; padding:0 8px; }
    .jackpot{
      position:relative; background:linear-gradient(180deg,#0e1519,#0a0f12);
      border:1px solid var(--line); border-radius:18px;
      box-shadow:0 0 22px rgba(0,255,255,.2), inset 0 0 0 1px rgba(255,255,255,.03);
      padding:18px 14px 22px; overflow:hidden;
    }
    .jp-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; gap:12px; flex-wrap:wrap; }
    .jp-title{ font-weight:900; letter-spacing:1.2px; color:var(--gold); text-shadow:0 0 18px rgba(255,180,45,.35); font-size:22px; }
    .jp-ctl{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
    .jp-reset{border:none; background:#132026; color:#cfe; border:1px solid var(--line); padding:6px 10px; border-radius:10px; cursor:pointer}
    .jp-reset:hover{background:#173038}
    .reels{ display:flex; justify-content:center; gap:10px; margin:8px auto 0; padding:10px 8px 0; }
    .reel{ width:110px; height:120px; border-radius:12px;
      background:radial-gradient(ellipse at 50% 0%, rgba(0,255,255,.10), rgba(0,0,0,.1) 60%), #0a1316;
      border:1px solid rgba(0,255,255,.14);
      box-shadow:inset 0 30px 30px rgba(0,0,0,.35), 0 8px 16px rgba(0,0,0,.35);
      display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; }
    .reel.small{ width:80px; } .reel.symbol{ width:90px; }
    .digit{ font-weight:900; font-variant-numeric:tabular-nums; font-size:56px; letter-spacing:1px;
      text-shadow:0 0 16px rgba(0,255,255,.25); transition:none !important; transform:none !important; }
    .sep{ display:flex; align-items:center; justify-content:center; width:28px; font-size:44px; opacity:.85 }
    .cap{ text-align:center; margin-top:10px; font-size:12px; color:#cfe; opacity:.85 }

    /* ===== Admin status pill ===== */
    .pill-status{
      display:flex; align-items:center; justify-content:center; gap:8px; width:100%;
      background:#0f151a; border:1px solid var(--line); border-radius:8px; padding:10px; margin-bottom:8px; color:#cfe;
    }
    .pill-status.ok{ color:#9ff1c7; border-color:rgba(0,255,200,.35);}

    @media (max-width: 1024px){
      .menu-btn{display:inline-block}
      .sidebar{transform:translateX(-100%); transition:transform .2s}
      .sidebar.open{transform:translateX(0)}
      .main{margin-left:0; padding-top:calc(var(--toph) + 12px)}
      .reel{width:86px; height:100px}
      .reel.small{width:64px}
      .reel.symbol{width:70px}
      .digit{font-size:46px}
      :root{ --icon-size: 38px; --icon-gap: 12px; }
    }
    @media (max-width: 640px){
      .reels{gap:6px}
      .reel{width:70px; height:86px}
      .reel.small{width:54px}
      .reel.symbol{width:58px}
      .digit{font-size:38px}
      .sep{width:22px; font-size:36px}
    }
  </style>

  <!-- API base (if you use it) -->
  <script>window.API_BASE="";</script>
  <script src="/assets/api-base.js" defer></script>

  <!-- optional raffle shim -->
  <script src="/assets/l3z_raffle.es5.js" defer></script>

  <!-- Topbar icons config -->
  <script>
    window.TOPBAR_ICON_CONFIG = {
      align: 'center',
      size: 48, gap: 18, radius: 10, hoverScale: 1.12,
      icons: [
        { href:'https://kick.com/lash3z',      src:'/assets/kick.png',      alt:'Kick',      show:true },
        { href:'https://x.com/Lash3_z',        src:'/assets/x_twitter.png', alt:'Twitter',   show:true },
        { href:'https://www.instagram.com/lash3z50/', src:'/assets/instagram.png', alt:'Instagram', show:true },
        { href:'https://www.facebook.com/lashesslots', src:'/assets/facebook.png',  alt:'Facebook',  show:true },
        { href:'https://www.youtube.com/@Lash3z-50',   src:'/assets/youtube.png',   alt:'YouTube',   show:true },
        { href:'https://discord.gg/fSVqK6cMmB',        src:'/assets/discord.png',   alt:'Discord',   show:true },
      ]
    };
  </script>
</head>
<body>

<!-- ===== TOP BAR ===== -->
<div class="topbar" role="banner">
  <div class="top-inner">
    <button id="menuBtn" class="menu-btn" aria-controls="sidebar" aria-expanded="false">☰ Menu</button>
    <div class="username-display" id="usernameDisplay">Welcome, PLAYER</div>

    <!-- Socials (center on desktop) -->
    <div id="iconBar" class="icon-bar center" aria-label="Social links"></div>

    <!-- Admin controls (right) -->
    <div class="toolrow">
      <a id="btnHome" href="/" class="toolbtn">Home</a>
      <a id="btnAdminLogin" href="/pages/dashboard/home/admin_login.html" class="toolbtn">Admin Login</a>
      <a id="btnAdminHub" href="/pages/dashboard/admin/admin_hub.html" class="toolbtn ok" style="display:none">Admin Hub</a>
      <a id="btnLogout" href="#" class="toolbtn bad" style="display:none">Log out</a>
    </div>
  </div>
</div>

<!-- ===== SIDEBAR ===== -->
<div id="sidebar" class="sidebar" role="navigation" aria-label="Sidebar">
  <h3>Dashboard</h3>
  <a class="navlink" href="/index.html"><img src="/assets/overview_icon.png" alt="Home">Home Page</a>

  <h3>Account</h3>
  <a class="navlink" href="/pages/dashboard/home/signup.html"><img src="/assets/signup.png" alt="Sign Up">Sign Up</a>
  <a class="navlink" href="/pages/dashboard/home/login.html"><img src="/assets/login.png" alt="Login">Login</a>
  <a class="navlink" href="/pages/dashboard/home/profile.html"><img src="/assets/signup.png" alt="Profile">Profile</a>

  <h3>Prediction Forms</h3>
  <a class="navlink" href="/pages/dashboard/home/battleground_prediction_form.html"><img src="/assets/battleground_icon.png" alt="Battleground">L3Z Battleground</a>
  <a class="navlink" href="/pages/dashboard/home/bonus_hunt_slot_requests.html"><img src="/assets/bonus_hunt_icon.png" alt="Bonus Hunt">Bonus Hunt Slot Requests</a>
  <a class="navlink" href="/pages/dashboard/home/pvp_entry_form.html"><img src="/assets/pvp_icon.png" alt="PVP Entry">PVP Entry Form</a>

  <h3>LASH3Z Bets</h3>
  <a class="navlink" href="/pages/dashboard/home/lash3z_bets.html"><img src="/assets/lash3zbux_pp.png" alt="L3Z Bets">Place Bets</a>
  <a class="navlink" href="/pages/dashboard/home/my_bets.html"><img src="/assets/lash3zbux_pp.png" alt="My Bets">My Bets</a>
  <a class="navlink" href="/pages/dashboard/home/lash3zbux_info.html"><img src="/assets/lash3zbux_pp.png" alt="Info">Bux Info</a>
  <a class="navlink" href="/pages/dashboard/home/lash3zbux_score_system.html"><img src="/assets/lash3zbux_pp.png" alt="Score">Bux Scoring</a>

  <h3>Leaderboard</h3>
  <a class="navlink" href="/pages/dashboard/home/leaderboard.html"><img src="/assets/overall_icon.png" alt="Leaderboard">Overall</a>

  <h3>Live Results</h3>
  <a class="navlink" href="/pages/dashboard/home/live_unified.html"><img src="/assets/overall_icon.png" alt="Unified Live">Unified Live</a>

  <h3>Giveaways</h3>
  <a class="navlink" href="/pages/dashboard/home/raffle_live.html"><img src="/assets/vip_icon.png" alt="Raffles Live">Raffles (Live)</a>
  <a class="navlink" href="/pages/dashboard/home/prize_claim.html"><img src="/assets/vip_icon.png" alt="Slot Wheel">Prize Claim </a>

  <h3>Information</h3>
  <a class="navlink" href="/pages/dashboard/home/about.html"><img src="/assets/paw.png" alt="About">About</a>
  <a class="navlink" href="/pages/dashboard/home/casino.html"><img src="/assets/mateslots_logo.png" alt="Casino">Casino</a>
  <a class="navlink" href="/pages/dashboard/home/vip.html"><img src="/assets/vip_icon.png" alt="VIP">VIP</a>
  

  <h3>Administration</h3>
  <div id="adminStatus" class="pill-status">Checking admin…</div>
  <a id="adminUnlock" class="navlink" href="/pages/dashboard/home/admin_login.html?redirect=%2Fpages%2Fdashboard%2Fadmin%2Fadmin_hub.html">
    <img src="/assets/L3Z_logoMain.png" alt="Unlock">Unlock Admin
  </a>
  <a id="adminLogoutSide" class="navlink" href="#" style="display:none">
    <img src="/assets/L3Z_logoMain.png" alt="Lock">Lock Admin (Log out)
  </a>

  <div class="navlink" style="justify-content:center;opacity:.8">Admin pages are server-locked</div>
  <a class="navlink" href="/pages/dashboard/admin/bets_admin.html"><img src="/assets/lash3zbux_pp.png" alt="Bets Admin">Bets Admin (Unified)</a>
  <a class="navlink" href="/pages/dashboard/admin/battleground_admin.html"><img src="/assets/lashes%20battleground.png" alt="BG Admin">Battleground Admin</a>
  <a class="navlink" href="/pages/dashboard/admin/battleground_widget.html"><img src="/assets/lashes%20battleground.png" alt="BG Widget">Battleground Widget</a>
  <a class="navlink" href="/pages/dashboard/admin/bonus_hunt_admin.html"><img src="/assets/bonus_hunt_icon.png" alt="BH Admin">Bonus Hunt Admin</a>
  <a class="navlink" href="/pages/dashboard/admin/bonus_hunt_widget.html"><img src="/assets/bonus_hunt_icon.png" alt="BH Widget">Bonus Hunt Widget</a>
  <a class="navlink" href="/pages/dashboard/admin/pvp_admin.html"><img src="/assets/pvp_icon.png" alt="PVP Admin">PVP Admin</a>
  <a class="navlink" href="/pages/dashboard/admin/lucky7.html"><img src="/assets/L3Z_logoMain.png" alt="Lucky7">Lucky 7</a>
  <a class="navlink" href="/pages/dashboard/admin/admin_hub.html"><img src="/assets/L3Z_logoMain.png" alt="Admin Hub">Admin Hub</a>
</div>

<!-- ===== MAIN ===== -->
<div class="main">

  <!-- Banner slider -->
  <div class="banner">
    <div class="slider" id="homeSlider" aria-label="Promotions">
      <button class="slide-nav prev" aria-label="Previous slide" type="button">❮</button>
      <button class="slide-nav next" aria-label="Next slide" type="button">❯</button>
      <div class="dots" id="homeSliderDots" aria-hidden="true"></div>
    </div>
  </div>

  <!-- Jackpot -->
  <div class="jackpot-wrap">
    <div class="jackpot">
      <div class="jp-header">
        <div class="jp-title">MONTHLY JACKPOT</div>
        <div class="jp-ctl">
          <button id="resetJackpotBtn" class="jp-reset" title="Reset this month" style="display:none">Reset Jackpot</button>
        </div>
      </div>

      <div class="reels" aria-live="polite" aria-label="Jackpot total">
        <div class="reel symbol"><div class="digit">$</div></div>
        <div class="reel"><div class="digit">0</div></div>
        <div class="reel"><div class="digit">0</div></div>
        <div class="reel"><div class="digit">0</div></div>
        <div class="reel"><div class="digit">0</div></div>
        <div class="sep"><strong>.</strong></div>
        <div class="reel small"><div class="digit">0</div></div>
        <div class="reel small"><div class="digit">0</div></div>
      </div>

      <div class="cap">
        Jackpots are made up of gifted subscriptions and monthly subscriptions as well as donations from Lash3z.
        The more gifted, the higher the jackpot.
      </div>
    </div>
  </div>

  <!-- Tiles -->
  <div class="tiles" aria-label="Quick links">
    <a class="tile" href="/pages/dashboard/home/battleground_prediction_form.html">
      <img src="/assets/lashes%20battleground.png" alt="Battle Ground"><span>Battle Ground</span>
    </a>
    <a class="tile" href="/pages/dashboard/home/bonus_hunt_slot_requests.html">
      <img src="/assets/bonus_hunt_icon.png" alt="Bonus Hunt"><span>Bonus Hunt</span>
    </a>
    <a class="tile" href="/pages/dashboard/home/leaderboard.html">
      <img src="/assets/lashes%20leaderboard.png" alt="Leaderboard"><span>Leader Board</span>
    </a>
    <a class="tile" href="/pages/dashboard/home/lash3z_bets.html">
      <img src="/assets/lash3zbux_pp.png" alt="L3Z Bets"><span>L3Z Bets</span>
    </a>
    <a class="tile" href="/pages/dashboard/home/profile.html">
      <img src="/assets/login.png" alt="Profile"><span>My Profile</span>
    </a>
    <a class="tile" href="/pages/dashboard/home/vip.html">
      <img src="/assets/vip_icon.png" alt="VIP"><span>VIP Access</span>
    </a>
    <a class="tile" href="/pages/dashboard/home/pvp_live.html">
      <img src="/assets/pvp_icon.png" alt="PVP Live"><span>PVP Live</span>
    </a>
    <a class="tile" href="/pages/dashboard/home/casino.html">
      <img src="/assets/mateslots_logo.png" alt="Casino"><span>Casino</span>
    </a>
  </div>
</div>

<!-- ===== Scripts ===== -->
<script>
(function(){
  "use strict";
  const $ = (s,r)=> (r||document).querySelector(s);
  const API = (typeof window!=="undefined" && window.API_BASE) ? window.API_BASE : "";

  /* Username (non-blocking; best-effort) */
  function sanitizeName(x){
    if (!x) return "";
    const m = String(x).toUpperCase().match(/[A-Z0-9_]+/g);
    return m ? m.join("") : "";
  }
  async function setUser(){
    try{
      const r = await fetch(API + "/api/wallet/me",{credentials:"include",cache:"no-store"});
      if (r.ok){
        const j = await r.json();
        const fromApi = j?.username || j?.user || j?.name || j?.displayName || "";
        const clean = sanitizeName(fromApi);
        if (clean){ $("#usernameDisplay").textContent = "Welcome, " + clean; return; }
      }
    }catch{}
    const fallback =
      localStorage.getItem("auth:username") ||
      localStorage.getItem("lash3z_last_user") ||
      localStorage.getItem("user:name") || "";
    const clean = sanitizeName(fallback);
    $("#usernameDisplay").textContent = "Welcome, " + (clean || "PLAYER");
  }

  /* Sidebar on mobile */
  function wireMenu(){
    const btn = $("#menuBtn"), side = $("#sidebar");
    if (!btn || !side) return;
    btn.addEventListener("click", ()=>{
      const open = side.classList.toggle("open");
      btn.setAttribute("aria-expanded", String(open));
    });
    side.querySelectorAll("a.navlink").forEach(a=>a.addEventListener("click", ()=> side.classList.remove("open")));
  }

  /* Build social icon bar */
  function buildIconBar(){
    const cfg = window.TOPBAR_ICON_CONFIG || {};
    const bar = $("#iconBar");
    if(!bar) return;
    bar.classList.remove('center','right');
    bar.classList.add((cfg.align||'center').toLowerCase());
    const root = document.documentElement;
    if(cfg.size)       root.style.setProperty('--icon-size', cfg.size + 'px');
    if(cfg.gap)        root.style.setProperty('--icon-gap',  cfg.gap  + 'px');
    if(cfg.radius!=null) root.style.setProperty('--icon-radius', cfg.radius + 'px');
    if(cfg.hoverScale) root.style.setProperty('--icon-hover-scale', cfg.hoverScale);
    const list = (cfg.icons||[]).filter(i=>i && i.show!==false);
    bar.innerHTML = list.map(i=>`
      <a class="icon-link" href="${i.href}" target="_blank" rel="noopener">
        <img class="icon-img" src="${i.src}" alt="${i.alt||''}" title="${i.alt||''}">
      </a>`).join('');
  }

  /* Admin status controls (top + sidebar) */
  async function paintAdminStatus(){
    const badge   = $("#adminStatus");
    const unlock  = $("#adminUnlock");
    const logoutS = $("#adminLogoutSide");
    const btnLogin= $("#btnAdminLogin");
    const btnHub  = $("#btnAdminHub");
    const btnOut  = $("#btnLogout");
    const rb      = $("#resetJackpotBtn"); // admin-only control
    try{
      const r = await fetch(API + "/api/admin/gate/check", { credentials:"include", cache:"no-store" });
      const j = r.ok ? await r.json() : null;
      const isAdmin = !!(j && j.admin);

      // Sidebar pill + buttons
      if (badge){
        badge.textContent = isAdmin ? "Admin: UNLOCKED" : "Admin: LOCKED";
        badge.classList.toggle("ok", isAdmin);
      }
      if (unlock){
        unlock.textContent = isAdmin ? "Go to Admin Hub" : "Unlock Admin";
        unlock.href = isAdmin
          ? "/pages/dashboard/admin/admin_hub.html"
          : "/pages/dashboard/home/admin_login.html?redirect=%2Fpages%2Fdashboard%2Fadmin%2Fadmin_hub.html";
      }
      if (logoutS) logoutS.style.display = isAdmin ? "" : "none";

      // Topbar buttons
      if (btnLogin) btnLogin.style.display = isAdmin ? "none" : "";
      if (btnHub)   btnHub.style.display   = isAdmin ? "" : "none";
      if (btnOut)   btnOut.style.display   = isAdmin ? "" : "none";

      // Jackpot reset visibility (admin only)
      if (rb) rb.style.display = isAdmin ? "" : "none";
    }catch{
      if (badge){ badge.textContent="Admin: Unknown (network error)"; badge.classList.remove("ok"); }
      if (unlock){
        unlock.textContent = "Unlock Admin";
        unlock.href = "/pages/dashboard/home/admin_login.html?redirect=%2Fpages%2Fdashboard%2Fadmin%2Fadmin_hub.html";
      }
      if (logoutS) logoutS.style.display = "none";
      if ($("#btnAdminLogin")) $("#btnAdminLogin").style.display = "";
      if ($("#btnAdminHub"))   $("#btnAdminHub").style.display   = "none";
      if ($("#btnLogout"))     $("#btnLogout").style.display     = "none";
      if ($("#resetJackpotBtn")) $("#resetJackpotBtn").style.display = "none";
    }
  }
  function wireAdminLogout(){
    const logoutS = $("#adminLogoutSide");
    const logoutT = $("#btnLogout");
    function doLogout(e){
      e.preventDefault();
      fetch(API + "/api/admin/gate/logout", { method:"POST", credentials:"include" })
        .finally(paintAdminStatus);
    }
    if (logoutS) logoutS.addEventListener("click", doLogout);
    if (logoutT) logoutT.addEventListener("click", doLogout);
  }

  /* Slider — preload candidates and only render images that exist */
  async function wireSlider(){
    const candidates = [
      "mates_slot1.png","mate_slot2.png","mate_slot3.png","mate_slot4.png",
      "mate_sltos5.png","mate_slot%206.png","lashes%20banner.png"
    ].map(n => "/assets/" + n);

    function probe(src){
      return new Promise(resolve=>{
        const img = new Image();
        img.onload = ()=> resolve(src);
        img.onerror = ()=> resolve(null);
        img.src = src;
      });
    }
    const good = (await Promise.all(candidates.map(probe))).filter(Boolean);
    const slider = document.getElementById("homeSlider");
    const dotsBox = document.getElementById("homeSliderDots");
    if(!slider) return;

    // If none valid, hide slider
    if(!good.length){ slider.style.display="none"; return; }

    const anchor = dotsBox;
    const slides = good.map((src,i)=>{
      const d = document.createElement("div");
      d.className = "slide" + (i===0 ? " active":"");
      const img = document.createElement("img");
      img.alt = "Promo " + (i+1);
      img.loading = "lazy";
      img.decoding = "async";
      img.src = src;
      d.appendChild(img);
      slider.insertBefore(d, anchor);
      return d;
    });

    const dots = good.map((_,i)=>{
      const b = document.createElement("button");
      b.type="button"; b.className="dot" + (i===0?" active":"");
      b.addEventListener("click", ()=>go(i, true));
      dotsBox.appendChild(b);
      return b;
    });

    const prev = slider.querySelector(".slide-nav.prev");
    const next = slider.querySelector(".slide-nav.next");

    let idx=0, timer=null, hover=false;
    const INTERVAL=10000;

    function setActive(i){
      slides[idx].classList.remove("active"); dots[idx].classList.remove("active");
      idx=i; slides[idx].classList.add("active"); dots[idx].classList.add("active");
    }
    function go(i,user){ if(i<0) i = slides.length-1; if(i>=slides.length) i = 0; setActive(i); if(user) restart(); }
    function nextFn(){ go(idx+1,false); }
    function start(){ if(!timer) timer=setInterval(()=>{ if(!hover) nextFn(); }, INTERVAL); }
    function stop(){ if(timer){ clearInterval(timer); timer=null; } }
    function restart(){ stop(); start(); }

    if(prev) prev.addEventListener("click", ()=>go(idx-1,true));
    if(next) next.addEventListener("click", ()=>go(idx+1,true));
    slider.addEventListener("mouseenter", ()=>{ hover=true; });
    slider.addEventListener("mouseleave", ()=>{ hover=false; });

    // swipe
    let sx=0, dx=0;
    slider.addEventListener("touchstart", e=>{ sx=e.touches[0].clientX; dx=0; }, {passive:true});
    slider.addEventListener("touchmove",  e=>{ dx=e.touches[0].clientX - sx; }, {passive:true});
    slider.addEventListener("touchend",   ()=>{ if(Math.abs(dx)>40) (dx<0? nextFn(): go(idx-1,true)); dx=0; }, {passive:true});

    start();
  }

  /* Kill any rogue service workers/caches (in case old SPA cached admin) */
  (async () => {
    try {
      const regs = await (navigator.serviceWorker?.getRegistrations?.() || []);
      for (const r of regs) await r.unregister();
      if (window.caches) { for (const k of await caches.keys()) await caches.delete(k); }
    } catch {}
  })();

  document.addEventListener("DOMContentLoaded", ()=>{
    setUser();
    wireMenu();
    buildIconBar();
    wireAdminLogout();
    paintAdminStatus();
    wireSlider();
  });
})();
</script>

<!-- Jackpot logic (your existing script) -->
<script src="/assets/js/jackpot.client.js" defer></script>
</body>
</html>
